<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Square Management System</title>
	<meta name="author" content="designer:sunxiangen, date:2019-10-12" />
	<!-- Favicon -->
	<link rel="shortcut icon" href="{url:@favicon.ico}">
	<link rel="icon" href="{url:@favicon.ico}" type="image/x-icon">
	<script src="{url:@static/vendors/jquery/dist/jquery.min.js}"></script>
	<link href="{url:@static/vendors/sweetalert/dist/sweetalert.css}" rel="stylesheet" type="text/css"/>
	<link href="{url:@static/vendors/bootstrap/dist/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
	<link href="{url:@static/css/style.css}" rel="stylesheet" type="text/css"/>
	<link href="{url:@static/css/style-fixed.css}" rel="stylesheet" type="text/css"/>

 	<style type="text/css">
 		.fixed-sidebar-left .side-nav > li > ul > li a {padding: 7px 15px 7px 35px;}
 		.fixed-sidebar-left .side-nav li a[aria-expanded="true"] {color: #f742aa;}
 		.fixed-sidebar-left .side-nav li a[aria-expanded="true"] > i {color: #f742aa;}
 		.fixed-sidebar-left .side-nav > li ul.collapse li a.active {color: #f742aa;}
 		.fa {width: 20px;}
	</style>
</head>
<body>
	<!-- Preloader -->
	<div class="preloader-it">
		<div class="la-anim-1"></div>
	</div>
	<!-- /Preloader -->
    <div class="wrapper theme-6-active pimary-color-pink">
		<!-- Top Menu Items -->
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="mobile-only-brand pull-left">
				<div class="nav-header pull-left">
					<div class="logo-wrap">
						<a href="index.html">
							<img class="brand-img" src="{url:@static/images/logo.png}" alt="brand"/>
							<span class="brand-text">Square</span>
						</a>
					</div>
				</div>	
				<a id="toggle_nav_btn" class="toggle-left-nav-btn inline-block ml-20 pull-left" href="javascript:void(0);">
					<i class="zmdi zmdi-menu"></i>
				</a>
			</div>
			<div id="mobile_only_nav" class="mobile-only-nav pull-right">
				<ul class="nav navbar-right top-nav pull-right">
					<li class="dropdown auth-drp">
						<a href="#" class="dropdown-toggle pr-0" data-toggle="dropdown"><i class="fa fa-fw fa-user"></i>{$manager['name']}<span class="user-online-status"></span></a>
						<ul class="dropdown-menu user-auth-dropdown" data-dropdown-in="flipInX" data-dropdown-out="flipOutX">
							<!--
							<li>
								<a href="JavaScript:;" onclick="swal('你好，{$this->manager['name']}');"><i class="zmdi zmdi-account"></i><span>我的信息</span></a>
							</li>
							-->
							<li>
								<a href="javascript:;" id="btn-password"><i class="zmdi zmdi-key"></i><span>修改密码</span></a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="{url:/admin/logout}"><i class="zmdi zmdi-power"></i><span>登出</span></a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
		<!-- /Top Menu Items -->
		<!-- Left Sidebar Menu -->
		<div class="fixed-sidebar-left">
			<ul class="nav navbar-nav side-nav nicescroll-bar">
				<!-- User Profile -->
				<li>
					<div class="user-profile text-center">
						<img src="{url:@static/images/no-img.png}" class="user-auth-img img-circle"/>
					</div>
				</li>
				<li><hr class="light-grey-hr mb-10"/></li>
				<!-- /User Profile -->
				{list:items=$menu->getSubMenu("system") item=$main}
				{set:$clink=$currentMenu['link']==$main['url']}
				{set:$csub=$currentMenu['subKey']==$main['link']}
				{if:$main['url']}
				<li>
					<a {if:$clink} class="active" {/if} href="{url:$main[url]}">
						<div class="pull-left">
							<i class="fa fa-fw {$main['icon']}  mr-10"></i>
							<span class="right-nav-text">{$main['name']}</span>
						</div>
						<div class="clearfix"></div>
					</a>
				</li>
				{else:}
				<li>
					<a {if:$csub} class="active" {/if} 
					 href="javascript:;" data-toggle="collapse" data-target="#main_{$key}">
						<div class="pull-left">
							<i class="fa fa-fw {$main['icon']} mr-10"></i>
							<span class="right-nav-text">{$main['name']}</span>
						</div>
						<div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div>
						<div class="clearfix"></div>
					</a>
					<ul id="main_{$key}" class="collapse collapse-level-1 {if:$csub} in {/if}">
						{list:items=$menu->getNodes($main['link']) item=$node}
						{set:$currNod=$node["link"]==$currentMenu["link"]}
						{if:substr($node['link'],-4)!='edit'}
						<li>
							<a {if:$currNod} class="active" {/if}  href="{url:$node[link]}">
								<i class="fa {$node['icon']}"></i>
								{$node['name']}
							</a>
						</li>
						{/if}
						{/list}
					</ul>
				</li>
				{/if}
				{/list}
				<li></li>
				<li></li>
			</ul>
		</div>
		<!-- /Left Sidebar Menu -->
		<div class="page-wrapper">
            <div class="container-fluid">
            	<div class="row heading-bg">
				    <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
				      <h5 class="txt-dark">{$admin_title}</h5>
				    </div>
				    <!-- Breadcrumb -->
				    <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
				      <ol class="breadcrumb">
				        <li><a href="{url:/admin/index}">首页</a></li>
				        {if:$currentMenu["nodeKey"]}
				        <li><a href="#"><span>{$currentMenu["subName"]}</span></a></li>
				        {/if}
				        <li class="active"><span>{$currentMenu["title"]}</span></li>
				      </ol>
				    </div>
				    <!-- /Breadcrumb -->
				</div>
				<div class="panel panel-default card-view">
	            	{__viewcontents}
	            </div>
            </div>
            <!-- Footer -->
			<footer class="footer container-fluid pl-30 pr-30">
				<div class="row">
					<div class="col-sm-12">
						<p></p>
					</div>
				</div>
			</footer>
			<!-- /Footer -->
        </div>
    </div>
    <!-- /Main Content -->
    <!--password-->
    <div id="passwordmodal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
	    <form id="passwordform" action="{url:/manager/changepwd}">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	                <h5 class="modal-title">修改密码</h5>
	            </div>
	            <div class="modal-body">
	            	<div class="form-group">
	                    <label class="control-label">原密码*：</label>
	                    <input class="form-control" name="oldpwd" id="oldpwd" type="password">
	                </div>
	                <div class="form-group">
	                    <label class="control-label">新密码*：</label>
	                    <input class="form-control" name="newpwd" id="newpwd" type="password">
	                </div>
	                <div class="form-group">
	                    <label class="control-label"> 密码确认*：</label>
	                    <input type="password" class="form-control" name="renewpwd" id="renewpwd">
	                </div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	                <button type="submit" class="btn btn-primary">保存密码</button>
	            </div>
	        </div>
	    </div>
	    </form>
	</div>
	<!-- password end-->

    <!-- /#wrapper -->
	<script src="{url:@static/vendors/bootstrapvalidator/dist/js/bootstrapValidator.min.js}"></script>
	<!-- JavaScript -->
	<script src="{url:@static/js/common.js}"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="{url:@static/vendors/bootstrap/dist/js/bootstrap.min.js}"></script>
    <script src="{url:@static/vendors/switchery/dist/switchery.min.js}"></script>
	<!-- Slimscroll JavaScript -->
	<script src="{url:@static/js/jquery.slimscroll.js}"></script>
	<!-- Sweet-Alert  -->
	<script src="{url:@static/vendors/sweetalert/dist/sweetalert.min.js}"></script>
	<script src="{url:@static/vendors/jquery.counterup/jquery.counterup.min.js}"></script>
	<!-- Init JavaScript -->
	<script src="{url:@static/js/init.js}"></script>
</body>

<script type="text/javascript">
 	$(document).ready(function() {
        passwdValidator();
    });

    $('#btn-password').on('click',function(){
        //$('#password-modal').find('[type="password"]').val("");
        $('#passwordmodal').modal();
        return false;
    });

    $("#passwordmodal").on("hide.bs.modal", function(){
        var $form = $('#passwordform'),
            bv    = $form.data('bootstrapValidator');
        $form
            .bootstrapValidator('disableSubmitButtons', false)  
            .bootstrapValidator('resetForm', true);             
    });

    function passwdValidator() {
        $('#passwordform').bootstrapValidator({
            message: '输入不正确',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
            	oldpwd: {
                    validators: {
                        notEmpty: {
                            message: '不能为空'
                        }
                    }
                },
                newpwd: {
                    validators: {
                        notEmpty: {
                            message: '不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 30,
                            message: '长度必须在 6 到 30 个字符'
                        },
                        identical: {
                            field: 'renewpwd',
                            message: ' '
                        }
                    }
                },
                renewpwd: {
                    validators: {
                        notEmpty: {
                            message: '不能为空'
                        },
                        identical: {
                            field: 'newpwd',
                            message: '密码必须一致'
                        }
                    }
                }
            }
        }).on('success.form.bv', function(e) {
            e.preventDefault();
            var $form = $(e.target),
                bv    = $form.data('bootstrapValidator');
            $form.bootstrapValidator('disableSubmitButtons', true);
            //$('button[type="submit"]').hide();
            $.post(
                $(this).attr('action'),
                $(this).serialize(), 
                function (result) {
                    swal({   
                        title: result.msg,   
                        //text: "2 秒钟后自动关闭.",   
                        timer: 2000,   
                        showConfirmButton: true 
                    },function(){
                    	if (result.status == "success") {
	                        $('#passwordmodal').modal("hide");
	                        location.href="{url:/admin/logout}";
	                    }
                    });
            }, 'json');
        });
    }
 </script>

</html>


