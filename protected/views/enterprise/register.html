<div class="panel-body">
  <form class="form-horizontal" action="{url:/enterprise/register_act}" method="post" id="main_form" name="main_form">
      <div class="col-md-11 col-sm-11">
          <div class="message">{$errmsg}</div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">企业账号：</label>
            <div class="col-md-9 col-sm-9">
              <div class="input-group">
                <input type="text" class="form-control" id="account" name="account" value="{$account}" readonly>
                <div class="input-group-addon" style="cursor: pointer;" id="btnKey">重新生成</div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">*企业名称：</label>
            <div class="col-md-9 col-sm-9">
              <input type="text" class="form-control" name="name" value="{$name}" pattern="required" alt="企业名称不能为空">
              <label class="valid-msg"></label>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">*密码：</label>
            <div class="col-md-9 col-sm-9">
              <input type="password" class="form-control" name="password" autocomplete="new-password"  bind="repassword" pattern="\w{6,}" alt="密码长度必须大于6位">
              <label class="valid-msg"></label>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">*密码确认：</label>
            <div class="col-md-9 col-sm-9">
              <input type="password" class="form-control" name="repassword" autocomplete="new-password" bind="password" alt="密码输入必须一致">
              <label class="valid-msg"></label>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">*验证手机：</label>
            <div class="col-md-9 col-sm-9">
              <div class="input-group">
                <input type="text" class="form-control" id="mobile" name="mobile" value="{$mobile}" pattern="mobi">
                <div class="input-group-addon" style="cursor: pointer;" id="sendSMS">获取验证码</div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 col-sm-3 control-label">*验证码：</label>
            <div class="col-md-9 col-sm-9">
              <input type="text" class="form-control" name="code" value="{$code}" pattern="\d{6}" alt="验证码不能为空">
              <label class="valid-msg"></label>
            </div>
          </div>
          <div class="form-actions mt-30">
            <div class="form-group">
              <label class="col-md-3 col-sm-3 control-label"></label>
              <div class="col-md-9 col-sm-9">
                {token:key=form}
                <button type="submit" class="btn btn-primary" style="width: 180px;"> 立刻注册</button>
              </div>
            </div>
          </div>
      </div>
  </form>
</div>

<script type="text/javascript">

    $(function(){

        //btnkey.click
        $("#btnKey").click(function() {
            $.ajax({
                type: "get",
                url: "{url:/enterprise/etpkeygenerate}",
                dataType: 'json',
                success: function(result) {
                    if (result['status'] == 'success') {
                      $("#account").val(result['msg']);
                    } else {
                        swal(result['msg']);
                    }
                },
                error:function(){
                  swal("发生错误，生成失败");
                }
            });
        });
        //btnkey.click

        // #sendSMS.click
        // #sendSMS.click
        $("#sendSMS").click(function(event) {
            var btn = $("#sendSMS");
            if (btn.attr("status")=="disabled") return;
            var mobi=$("#mobile").val();
            if(mobi=="") {
                swal("手机号码不正确！");
                return false;
            }

            btn.attr("status","disabled");

            $.ajax({
                type: "get",
                url: "{url:/index/sendsms}",
                data: {mobile:mobi,type:'reg'},
                dataType: 'json',
                success: function(result) {
                    if (result['status'] == 'success') {
                        var i = 120;
                        btn.html(i + '秒');
                        var timer = setInterval(function() {
                            i--;
                            btn.html(i + '秒');
                            if (i <= 0) {
                                clearInterval(timer);
                                btn.html('获取验证码');
                                btn.attr("status", "");
                            }
                        }, 1000);
                    } else {
                        swal(result['msg']);
                    }
                }
            });
        });

        $("#sendSMS3").click(function(event) {
            var mobi=$("#mobile").val();
            if(mobi=="" || autoValidate.validate(document.getElementById('mobile'))===false) {
                swal("请输入正确的手机号码");
                return false;
            }

            $.ajax({
                type: "get",
                url: "{url:/index/sendsms}",
                data: {mobile:mobi,type:'reg'},
                dataType: 'json',
                success: function(result) {
                    if (result['status'] == 'success') {
                        $('#mobile').attr("readonly", "readonly");
                        var send_sms = $("#sendSMS");
                        send_sms.attr("disabled", true);
                        send_sms.addClass("btn-disable");
                        var i = 120;
                        send_sms.html(i + '秒');
                        var timer = setInterval(function() {
                            i--;
                            send_sms.html(i + '秒');
                            if (i <= 0) {
                                clearInterval(timer);
                                send_sms.html('获取验证码');
                                $('#mobile').removeAttr("readonly");
                                send_sms.removeClass("btn-disable");
                                send_sms.attr("disabled", false);
                            }
                        }, 1000);
                    } else {
                        swal(result['msg']);
                    }
                }
            });
        });
        // #sendSMS.click
  });


</script>